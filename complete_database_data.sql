-- ===========================================
-- 中北大学宿舍管理系统 - 完整数据库数据
-- 包含所有表的数据插入和提醒功能
-- ===========================================

USE dormitory_management;

-- 清空所有数据
SET FOREIGN_KEY_CHECKS = 0;
TRUNCATE TABLE repair_application;
TRUNCATE TABLE violation;
TRUNCATE TABLE payment;
TRUNCATE TABLE student;
TRUNCATE TABLE bed;
TRUNCATE TABLE dormitory;
TRUNCATE TABLE user;
TRUNCATE TABLE reminder;
SET FOREIGN_KEY_CHECKS = 1;

-- ===========================================
-- 1. 创建提醒表
-- ===========================================
CREATE TABLE IF NOT EXISTS reminder (
    reminder_id VARCHAR(50) PRIMARY KEY COMMENT '提醒ID',
    student_id VARCHAR(20) NOT NULL COMMENT '学生学号',
    student_name VARCHAR(50) NOT NULL COMMENT '学生姓名',
    type VARCHAR(20) NOT NULL COMMENT '提醒类型：缴费提醒、违纪处理提醒',
    title VARCHAR(100) NOT NULL COMMENT '提醒标题',
    content TEXT NOT NULL COMMENT '提醒内容',
    priority VARCHAR(10) NOT NULL DEFAULT '中' COMMENT '优先级：高、中、低',
    status VARCHAR(20) NOT NULL DEFAULT '待处理' COMMENT '状态：待处理、已处理、已忽略',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    handle_time TIMESTAMP NULL COMMENT '处理时间',
    handler VARCHAR(50) COMMENT '处理人',
    INDEX idx_student_id (student_id),
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='提醒信息表';

-- ===========================================
-- 2. 插入管理员用户
-- ===========================================
INSERT INTO user (user_id, password, user_type) VALUES ('admin', '123456', '管理员');

-- ===========================================
-- 3. 插入宿舍楼数据 (中北大学真实宿舍名称)
-- ===========================================
INSERT INTO dormitory (dorm_id, building, floor, capacity, manager_name, manager_phone) VALUES
('文瀛1-101', '文瀛苑', 1, 4, '张主任', '13834567890'),
('文瀛1-102', '文瀛苑', 1, 4, '张主任', '13834567890'),
('文瀛1-103', '文瀛苑', 1, 4, '张主任', '13834567890'),
('文瀛1-104', '文瀛苑', 1, 4, '张主任', '13834567890'),
('文瀛1-105', '文瀛苑', 1, 4, '张主任', '13834567890'),
('文瀛1-201', '文瀛苑', 2, 6, '张主任', '13834567890'),
('文瀛1-202', '文瀛苑', 2, 6, '张主任', '13834567890'),
('文瀛1-203', '文瀛苑', 2, 6, '张主任', '13834567890'),
('文韬2-101', '文韬苑', 1, 4, '李主任', '13834567891'),
('文韬2-102', '文韬苑', 1, 4, '李主任', '13834567891'),
('文韬2-103', '文韬苑', 1, 4, '李主任', '13834567891'),
('文韬2-104', '文韬苑', 1, 4, '李主任', '13834567891'),
('文韬2-201', '文韬苑', 2, 6, '李主任', '13834567891'),
('文韬2-202', '文韬苑', 2, 6, '李主任', '13834567891'),
('文澜3-101', '文澜苑', 1, 4, '王主任', '13834567892'),
('文澜3-102', '文澜苑', 1, 4, '王主任', '13834567892'),
('文澜3-103', '文澜苑', 1, 4, '王主任', '13834567892'),
('文澜3-201', '文澜苑', 2, 6, '王主任', '13834567892'),
('文澜3-202', '文澜苑', 2, 6, '王主任', '13834567892'),
('文澜1-101', '文澜苑', 1, 4, '周主任', '13834567897'),
('文澜1-102', '文澜苑', 1, 4, '周主任', '13834567897'),
('文澜1-201', '文澜苑', 2, 6, '周主任', '13834567897'),
('怡丁1-101', '怡丁苑', 1, 4, '吴主任', '13834567898'),
('怡丁1-102', '怡丁苑', 1, 4, '吴主任', '13834567898');

-- ===========================================
-- 4. 插入床位数据
-- ===========================================
INSERT INTO bed (bed_id, dorm_id, status, student_id) VALUES
('文瀛1-101-01', '文瀛1-101', '占用', NULL),
('文瀛1-101-02', '文瀛1-101', '占用', NULL),
('文瀛1-101-03', '文瀛1-101', '占用', NULL),
('文瀛1-101-04', '文瀛1-101', '占用', NULL),
('文瀛1-102-01', '文瀛1-102', '占用', NULL),
('文瀛1-102-02', '文瀛1-102', '占用', NULL),
('文瀛1-102-03', '文瀛1-102', '占用', NULL),
('文瀛1-102-04', '文瀛1-102', '占用', NULL),
('文韬2-101-01', '文韬2-101', '占用', NULL),
('文韬2-101-02', '文韬2-101', '占用', NULL),
('文韬2-101-03', '文韬2-101', '占用', NULL),
('文韬2-101-04', '文韬2-101', '占用', NULL),
('文澜1-101-01', '文澜1-101', '空闲', NULL),
('文澜1-101-02', '文澜1-101', '空闲', NULL),
('文澜1-101-03', '文澜1-101', '空闲', NULL),
('文澜1-101-04', '文澜1-101', '空闲', NULL);

-- ===========================================
-- 5. 插入学生数据
-- ===========================================
INSERT INTO student (student_id, password, name, college_name, class_name, gender, birthday, email, phone, bed_id) VALUES
('2413041837', '123456', '任万博', '计算机学院', '计算机2101', '男', '2004-05-15', 'renwanbo@nuc.edu.cn', '13834561234', '文瀛1-101-01'),
('2413041801', '123456', '张三', '计算机学院', '计算机2101', '男', '2004-03-12', 'zhangsan@nuc.edu.cn', '13834561235', '文瀛1-101-02'),
('2413041802', '123456', '李四', '计算机学院', '计算机2101', '男', '2004-07-22', 'lisi@nuc.edu.cn', '13834561236', '文瀛1-101-03'),
('2413041803', '123456', '王五', '计算机学院', '计算机2101', '男', '2004-01-08', 'wangwu@nuc.edu.cn', '13834561237', '文瀛1-101-04'),
('2413091804', '123456', '姜三十五', '机械学院', '机械2101', '男', '2004-02-14', 'jiangsanwu@nuc.edu.cn', '13834561267', '文韬2-101-01'),
('2413101801', '123456', '戚三十六', '信息学院', '信息2101', '女', '2004-10-09', 'qisaniu@nuc.edu.cn', '13834561268', '文澜1-101-01');

-- ===========================================
-- 6. 更新床位表中的学生ID
-- ===========================================
UPDATE bed SET student_id = CASE bed_id
    WHEN '文瀛1-101-01' THEN '2413041837'
    WHEN '文瀛1-101-02' THEN '2413041801'
    WHEN '文瀛1-101-03' THEN '2413041802'
    WHEN '文瀛1-101-04' THEN '2413041803'
    WHEN '文韬2-101-01' THEN '2413091804'
    WHEN '文澜1-101-01' THEN '2413101801'
    ELSE NULL
END WHERE bed_id IN ('文瀛1-101-01','文瀛1-101-02','文瀛1-101-03','文瀛1-101-04','文韬2-101-01','文澜1-101-01');

-- ===========================================
-- 7. 插入学生用户账户
-- ===========================================
INSERT INTO user (user_id, password, user_type) VALUES
('2413041837', '123456', '学生'),
('2413041801', '123456', '学生'),
('2413041802', '123456', '学生'),
('2413041803', '123456', '学生'),
('2413091804', '123456', '学生'),
('2413101801', '123456', '学生');

-- ===========================================
-- 8. 插入缴费记录
-- ===========================================
INSERT INTO payment (payment_id, student_id, amount, payment_date, semester, status) VALUES
('PAY001', '2413041837', 1200.00, '2024-09-01', '2024-2025学年第一学期', '已缴'),
('PAY002', '2413041801', 1200.00, '2024-09-02', '2024-2025学年第一学期', '已缴'),
('PAY003', '2413041802', 1200.00, '2024-09-03', '2024-2025学年第一学期', '已缴'),
('PAY004', '2413091804', 1200.00, NULL, '2024-2025学年第一学期', '未缴'),
('PAY005', '2413101801', 1200.00, NULL, '2024-2025学年第一学期', '未缴');

-- ===========================================
-- 9. 插入违纪记录
-- ===========================================
INSERT INTO violation (violation_id, student_id, description, violation_date, penalty) VALUES
('VIO001', '2413041802', '晚归宿舍', '2024-09-15', '口头警告'),
('VIO002', '2413091804', '未经许可留宿外人', '2024-10-15', '警告处分');

-- ===========================================
-- 10. 插入维修申请记录
-- ===========================================
INSERT INTO repair_application (apply_id, student_id, fault_location, fault_desc, contact_phone, apply_time, status, handler, finish_time) VALUES
('REP001', '2413041837', '文瀛1-101宿舍', '台灯不亮，无法正常使用', '13834561234', '2024-09-10 14:30:00', 'completed', '张主任', '2024-09-11 10:00:00'),
('REP002', '2413091804', '文韬2-101宿舍', '书桌抽屉卡住', '13834561265', '2024-09-28 14:45:00', 'completed', '李主任', '2024-09-29 11:20:00'),
('REP003', '2413101801', '文澜1-101宿舍', '衣柜门铰链松动', '13834561268', '2024-10-01 16:30:00', 'pending', NULL, NULL);

-- ===========================================
-- 11. 插入提醒数据（自动生成）
-- ===========================================
INSERT INTO reminder (reminder_id, student_id, student_name, type, title, content, priority, status, create_time) VALUES
('REMINDER_001', '2413091804', '姜三十五', '缴费提醒', '住宿费未缴提醒', '学生姜三十五(2413091804)存在未缴纳的住宿费用，请及时处理。', '高', '待处理', NOW()),
('REMINDER_002', '2413101801', '戚三十六', '缴费提醒', '住宿费未缴提醒', '学生戚三十六(2413101801)存在未缴纳的住宿费用，请及时处理。', '高', '待处理', NOW()),
('REMINDER_003', '2413091804', '姜三十五', '违纪处理提醒', '违纪记录处理提醒', '学生姜三十五(2413091804)存在未处理的违纪记录：未经许可留宿外人，请及时处理。', '中', '待处理', NOW());

-- ===========================================
-- 数据验证
-- ===========================================
SELECT '数据导入完成统计' as title;
SELECT 'user' as table_name, COUNT(*) as count FROM user UNION ALL
SELECT 'student' as table_name, COUNT(*) as count FROM student UNION ALL
SELECT 'dormitory' as table_name, COUNT(*) as count FROM dormitory UNION ALL
SELECT 'bed' as table_name, COUNT(*) as count FROM bed UNION ALL
SELECT 'payment' as table_name, COUNT(*) as count FROM payment UNION ALL
SELECT 'violation' as table_name, COUNT(*) as count FROM violation UNION ALL
SELECT 'repair_application' as table_name, COUNT(*) as count FROM repair_application UNION ALL
SELECT 'reminder' as table_name, COUNT(*) as count FROM reminder;